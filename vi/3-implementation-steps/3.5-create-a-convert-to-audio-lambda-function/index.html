<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.127.0">
    <meta name="description" content="">
<meta name="author" content="21133090@student.hcmute.edu.vn">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Tạo hàm Lambda chuyển đổi sang âm thanh :: Xây dựng ứng dụng chuyển văn bản thành giọng nói không cần máy chủ với Amazon Polly</title>

    
    <link href="/css/nucleus.css?1726994306" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1726994306" rel="stylesheet">
    <link href="/css/hybrid.css?1726994306" rel="stylesheet">
    <link href="/css/featherlight.min.css?1726994306" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1726994306" rel="stylesheet">
    <link href="/css/auto-complete.css?1726994306" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1726994306" rel="stylesheet">
    <link href="/css/theme.css?1726994306" rel="stylesheet">
    <link href="/css/hugo-theme.css?1726994306" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1726994306" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1726994306"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/3-implementation-steps/3.5-create-a-convert-to-audio-lambda-function/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1726994306"></script>
<script type="text/javascript" src="/js/auto-complete.js?1726994306"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/Trung1616.github.io\/\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1726994306"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các bước chuẩn bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/">
           <b> 2. </b> Các bước chuẩn bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/" title="Các bước thực hiện" class="dd-item 
        parent
        
        
        ">
      <a href="/vi/3-implementation-steps/">
           <b> 3. </b> Các bước thực hiện
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.1-create-a-dynamodb-table/" title="Tạo bảng DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.1-create-a-dynamodb-table/">
           <b> 3.1. </b> Tạo bảng DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.2-create-an-amazon-s3-bucket/" title="Tạo Amazon S3 bucket" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.2-create-an-amazon-s3-bucket/">
           <b> 3.2. </b> Tạo Amazon S3 bucket
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.3-create-an-sns-topic/" title="Tạo chủ đề SNS" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.3-create-an-sns-topic/">
           <b> 3.3. </b> Tạo chủ đề SNS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.4-creat-a-new-post-lambda-function/" title="Tạo hàm Lambda cho bài đăng mới" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.4-creat-a-new-post-lambda-function/">
           <b> 3.4. </b> Tạo hàm Lambda cho bài đăng mới
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.5-create-a-convert-to-audio-lambda-function/" title="Tạo hàm Lambda chuyển đổi sang âm thanh" class="dd-item 
        
        active
        
        ">
      <a href="/vi/3-implementation-steps/3.5-create-a-convert-to-audio-lambda-function/">
           <b> 3.5. </b> Tạo hàm Lambda chuyển đổi sang âm thanh
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.6-test-the-functions/" title="Kiểm tra các chức năng" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.6-test-the-functions/">
           <b> 3.6. </b> Kiểm tra các chức năng
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.7-create-a-get-post-lambda-function/" title="Tạo hàm Lambda get post" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.7-create-a-get-post-lambda-function/">
           <b> 3.7. </b> Tạo hàm Lambda get post
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.8-expose-the-lambda-function-as-a-restful-web-service/" title="Trình bày chức năng Lambda như một dịch vụ web RESTful" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.8-expose-the-lambda-function-as-a-restful-web-service/">
           <b> 3.8. </b> Trình bày chức năng Lambda như một dịch vụ web RESTful
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-implementation-steps/3.9-create-a-serverless-user-interface/" title="Tạo giao diện người dùng không có máy chủ" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-implementation-steps/3.9-create-a-serverless-user-interface/">
           <b> 3.9. </b> Tạo giao diện người dùng không có máy chủ
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-summary/" title="Kết luận hội thảo" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-summary/">
           <b> 4. </b> Kết luận hội thảo
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/5-cleanup/" title="Dọn dẹp tài nguyên  " class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/">
          <b>5. </b>Dọn dẹp tài nguyên  
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/5-cleanup/5.1-delete-amazon-sns/" title="Xóa Amazon SNS" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/5.1-delete-amazon-sns/">
           <b> 5.1. </b> Xóa Amazon SNS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-cleanup/5.2-delete-lambda-functions/" title="Xóa Hàm Lambda" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/5.2-delete-lambda-functions/">
           <b> 5.2. </b> Xóa Hàm Lambda
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-cleanup/5.3-delete-amazon-dynamodb/" title="Xóa Amazon DynamoDB" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/5.3-delete-amazon-dynamodb/">
           <b> 5.3. </b> Xóa Amazon DynamoDB
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-cleanup/5.4-delete-amazon-s3-buckets/" title="Xóa Amazon S3 Buckets" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/5.4-delete-amazon-s3-buckets/">
           <b> 5.4. </b> Xóa Amazon S3 Buckets
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-cleanup/5.5-delete-amazon-api-gateway/" title="Xóa Amazon API Gateway." class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/5.5-delete-amazon-api-gateway/">
           <b> 5.5. </b> Xóa Amazon API Gateway.
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/5-cleanup/5.6-delete-cloudformation-stack/" title="Xóa Amazon SNS" class="dd-item 
        
        
        
        ">
      <a href="/vi/5-cleanup/5.6-delete-cloudformation-stack/">
           <b> 5.6. </b> Xóa Amazon SNS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/6-future-expansion-directions-and-references/" title="Hướng mở rộng trong tương lai và tài liệu tham khảo" class="dd-item 
        
        
        
        ">
      <a href="/vi/6-future-expansion-directions-and-references/">
           <b> 6. </b> Hướng mở rộng trong tương lai và tài liệu tham khảo
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="http://Trung1616.github.io/3-implementation-steps/3.5-create-a-convert-to-audio-lambda-function/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="http://Trung1616.github.io/vi/3-implementation-steps/3.5-create-a-convert-to-audio-lambda-function/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>20-09-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/th%C3%A0nh-trung-nguy%E1%BB%85n-a49128279/"  style="color:orange">Thành Trung </a> <br>
                
             
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Tổng quan</a> > <a href='/vi/3-implementation-steps/'>Các bước thực hiện</a> > Tạo hàm Lambda chuyển đổi sang âm thanh
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tạo hàm Lambda chuyển đổi sang âm thanh
            </h1>
          

        



	<p>Bây giờ bạn tạo một hàm Lambda để chuyển đổi văn bản được lưu trữ trong bảng DynamoDB thành tệp âm thanh.</p>
<ol>
<li>Chọn <strong>Functions</strong> ở ngăn điều hướng phía trên bên trái.</li>
</ol>

<div class="notices note" ><p>Bạn có thể cần mở rộng ngăn điều hướng bằng cách chọn biểu tượng menu.</p>
</div>

<ol start="2">
<li>Chọn <strong>Create function</strong>.
<img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/1.png"></li>
</ol>
<ul>
<li>
<p>Chọn <strong>Author from scratch</strong> và sử dụng các cài đặt sau:</p>
<ul>
<li><strong>Function name:</strong> <em>ConvertToAudio</em></li>
<li><strong>Runtime:</strong> Python 3.12</li>
<li>Mở rộng <strong>Change default execution role</strong></li>
<li><strong>Execution role:</strong> chọn <strong>Use an existing role</strong></li>
<li><strong>Existing role:</strong> chọn <strong>Lab-Lambda-Role</strong></li>
</ul>
</li>
<li>
<p>Cuộn xuống và chọn <strong>Create function</strong>.</p>
</li>
</ul>
<p><img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/2.png">
<img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/3.png"></p>
<ol start="3">
<li><strong>Lệnh</strong> Xóa mã hiện tại và dán mã sau:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> contextlib <span style="color:#f92672">import</span> closing
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> boto3.dynamodb.conditions <span style="color:#f92672">import</span> Key, Attr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lambda_handler</span>(event, context):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    postId <span style="color:#f92672">=</span> event[<span style="color:#e6db74">&#34;Records&#34;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;Sns&#34;</span>][<span style="color:#e6db74">&#34;Message&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print (<span style="color:#e6db74">&#34;Text to Speech function. Post ID in DynamoDB: &#34;</span> <span style="color:#f92672">+</span> postId)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Retrieving information about the post from DynamoDB table</span>
</span></span><span style="display:flex;"><span>    dynamodb <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>resource(<span style="color:#e6db74">&#39;dynamodb&#39;</span>)
</span></span><span style="display:flex;"><span>    table <span style="color:#f92672">=</span> dynamodb<span style="color:#f92672">.</span>Table(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;DB_TABLE_NAME&#39;</span>])
</span></span><span style="display:flex;"><span>    postItem <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span>query(
</span></span><span style="display:flex;"><span>        KeyConditionExpression<span style="color:#f92672">=</span>Key(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>eq(postId)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    text <span style="color:#f92672">=</span> postItem[<span style="color:#e6db74">&#34;Items&#34;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;text&#34;</span>]
</span></span><span style="display:flex;"><span>    voice <span style="color:#f92672">=</span> postItem[<span style="color:#e6db74">&#34;Items&#34;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;voice&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    rest <span style="color:#f92672">=</span> text
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Because single invocation of the polly synthesize_speech api can</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># transform text with about 3000 characters, we are dividing the</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># post into blocks of approximately 2500 characters.</span>
</span></span><span style="display:flex;"><span>    textBlocks <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (len(rest) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2600</span>):
</span></span><span style="display:flex;"><span>        begin <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        end <span style="color:#f92672">=</span> rest<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;.&#34;</span>, <span style="color:#ae81ff">2500</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (end <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            end <span style="color:#f92672">=</span> rest<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34; &#34;</span>, <span style="color:#ae81ff">2500</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        textBlock <span style="color:#f92672">=</span> rest[begin:end]
</span></span><span style="display:flex;"><span>        rest <span style="color:#f92672">=</span> rest[end:]
</span></span><span style="display:flex;"><span>        textBlocks<span style="color:#f92672">.</span>append(textBlock)
</span></span><span style="display:flex;"><span>    textBlocks<span style="color:#f92672">.</span>append(rest)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># For each block, invoke Polly API, which transforms text into audio</span>
</span></span><span style="display:flex;"><span>    polly <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;polly&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> textBlock <span style="color:#f92672">in</span> textBlocks:
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> polly<span style="color:#f92672">.</span>synthesize_speech(
</span></span><span style="display:flex;"><span>            OutputFormat<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mp3&#39;</span>,
</span></span><span style="display:flex;"><span>            Text <span style="color:#f92672">=</span> textBlock,
</span></span><span style="display:flex;"><span>            VoiceId <span style="color:#f92672">=</span> voice
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Save the audio stream returned by Amazon Polly on Lambda&#39;s temp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># directory. If there are multiple text blocks, the audio stream</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># is combined into a single file.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;AudioStream&#34;</span> <span style="color:#f92672">in</span> response:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> closing(response[<span style="color:#e6db74">&#34;AudioStream&#34;</span>]) <span style="color:#66d9ef">as</span> stream:
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(<span style="color:#e6db74">&#34;/tmp/&#34;</span>, postId)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>isfile(output):
</span></span><span style="display:flex;"><span>                    mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ab&#34;</span>  <span style="color:#75715e"># Append binary mode</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wb&#34;</span>  <span style="color:#75715e"># Write binary mode (create a new file)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">with</span> open(output, mode) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>                    file<span style="color:#f92672">.</span>write(stream<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>    s3<span style="color:#f92672">.</span>upload_file(<span style="color:#e6db74">&#39;/tmp/&#39;</span> <span style="color:#f92672">+</span> postId,
</span></span><span style="display:flex;"><span>      os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>],
</span></span><span style="display:flex;"><span>      postId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.mp3&#34;</span>)
</span></span><span style="display:flex;"><span>    s3<span style="color:#f92672">.</span>put_object_acl(ACL<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;public-read&#39;</span>,
</span></span><span style="display:flex;"><span>      Bucket<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>],
</span></span><span style="display:flex;"><span>      Key<span style="color:#f92672">=</span> postId <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.mp3&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    location <span style="color:#f92672">=</span> s3<span style="color:#f92672">.</span>get_bucket_location(Bucket<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>])
</span></span><span style="display:flex;"><span>    region <span style="color:#f92672">=</span> location[<span style="color:#e6db74">&#39;LocationConstraint&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> region <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        url_beginning <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://s3.amazonaws.com/&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        url_beginning <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://s3-&#34;</span> <span style="color:#f92672">+</span> str(region) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.amazonaws.com/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    url <span style="color:#f92672">=</span> url_beginning \
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> str(os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>]) \
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> \
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> str(postId) \
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.mp3&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Updating the item in DynamoDB</span>
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> table<span style="color:#f92672">.</span>update_item(
</span></span><span style="display:flex;"><span>        Key<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;id&#39;</span>:postId},
</span></span><span style="display:flex;"><span>          UpdateExpression<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;SET #statusAtt = :statusValue, #urlAtt = :urlValue&#34;</span>,
</span></span><span style="display:flex;"><span>          ExpressionAttributeValues<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>            {<span style="color:#e6db74">&#39;:statusValue&#39;</span>: <span style="color:#e6db74">&#39;UPDATED&#39;</span>, <span style="color:#e6db74">&#39;:urlValue&#39;</span>: url},
</span></span><span style="display:flex;"><span>        ExpressionAttributeNames<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>          {<span style="color:#e6db74">&#39;#statusAtt&#39;</span>: <span style="color:#e6db74">&#39;status&#39;</span>, <span style="color:#e6db74">&#39;#urlAtt&#39;</span>: <span style="color:#e6db74">&#39;url&#39;</span>},
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span></span></span></code></pre></div>

<div class="notices info" ><p><strong>Giải thích mã:</strong> Hàm AWS Lambda này chuyển đổi văn bản được lưu trữ trong bản ghi DynamoDB thành tệp âm thanh MP3 bằng Amazon Polly. Hàm này lấy ID văn bản và giọng nói từ DynamoDB bằng ID bài đăng từ tin nhắn SNS, sau đó chia văn bản thành các khối khoảng 2500 ký tự (vì API của Polly có giới hạn ký tự). Mỗi khối được Polly xử lý để tổng hợp giọng nói và âm thanh kết quả được lưu trữ trong một tệp tạm thời. Sau đó, hàm này tải tệp âm thanh cuối cùng lên thùng S3, cho phép truy cập công khai và cập nhật bản ghi DynamoDB bằng URL của tệp MP3.</p>
</div>

<p>Kiểm tra mã. Hàm Lambda thực hiện những điều sau:</p>
<ul>
<li>Truy xuất ID của mục DynamoDB (ID bài đăng) cần được chuyển đổi thành tệp âm thanh từ tin nhắn đầu vào (sự kiện SNS)</li>
<li>Lấy mục từ DynamoDB</li>
<li>Chuyển đổi văn bản thành luồng âm thanh</li>
<li>Đặt tệp âm thanh (MP3) vào thùng S3</li>
<li>Cập nhật bảng DynamoDB bằng tham chiếu đến thùng S3 và trạng thái mới</li>
</ul>
<p>Phương thức <strong>synthesize_speech</strong> nhận văn bản cần chuyển đổi và giọng nói cần sử dụng. Đổi lại, nó cung cấp <strong>luồng âm thanh</strong>. Vấn đề là có giới hạn kích thước là 3000 ký tự trên văn bản có thể được cung cấp làm đầu vào. Vì bài đăng có thể lớn, nên các bài đăng cần được chia thành các khối khoảng 2500 ký tự, tùy thuộc vào vị trí kết thúc của từ cuối cùng trong khối. Sau khi chuyển đổi các khối thành luồng âm thanh, chúng được nối lại với nhau.</p>
<ol start="4">
<li>Chọn <strong>Deploy</strong>.</li>
</ol>
<p><img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/4.png"></p>
<ol start="5">
<li>Chọn tab <strong>Configuration</strong> để cấu hình các biến môi trường.</li>
<li>Trong ngăn điều hướng bên trái, chọn <strong>Environment variables</strong>.</li>
<li>Trong phần <strong>Environment variables</strong>, chọn <strong>Edit</strong>.
<img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/5.png"></li>
</ol>
<ul>
<li>
<p>Chọn <strong>Add environment variable</strong>.</p>
<ul>
<li><strong>Key:</strong> Nhập <em>DB_TABLE_NAME</em></li>
<li><strong>Value:</strong> Nhập <em>posts</em></li>
</ul>
</li>
<li>
<p>Chọn <strong>Add environment variable</strong>.</p>
<ul>
<li><strong>Key:</strong> Enter <em>BUCKET_NAME</em></li>
<li><strong>Value:</strong> Nhập tên của bucket bạn đã tạo trước đó. Nó sẽ trông giống như: audioposts-123</li>
</ul>
</li>
</ul>
<ol start="8">
<li>Chọn <strong>Save</strong>.</li>
</ol>
<p><img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/6.png">
<img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/7.png"></p>
<p>Các bài đăng cần chuyển đổi có thể khá lớn, vì vậy bạn cần kéo dài thời gian tối đa thực thi một mã lên 5 phút.</p>
<ol start="9">
<li>Trong phần <strong>General configuration</strong>, chọn <strong>Edit</strong>.
<img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/8.png"></li>
</ol>
<ul>
<li>Cập nhật <strong>Timeout</strong> lên 5 phút.</li>
<li>Chọn <strong>Save</strong>.
<img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/9.png"></li>
</ul>
<p><img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/10.png"></p>
<p>Bây giờ bạn cấu hình chức năng để tự động kích hoạt khi có tin nhắn được gửi đến chủ đề SNS mà bạn đã tạo trước đó.</p>
<ol start="10">
<li>Trong phần <strong>Triggers</strong>, chọn <strong>Add trigger</strong> rồi cấu hình:</li>
</ol>
<p><img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/11.png"></p>
<ul>
<li><strong>Select a source:</strong> SNS</li>
<li><strong>SNS topic:</strong> Chọn <em>new_posts</em> từ các chủ đề có sẵn.</li>
<li>Chọn <strong>Add</strong>.</li>
</ul>
<p><img alt="images" src="/images/3-implementation-steps/3.5-Create-a-convert-to-audio-Lambda-function/12.png"></p>
<p>Bây giờ bạn đã sẵn sàng để kiểm tra xem hai hàm Lambda có giao tiếp thành công qua SNS hay không và tạo tệp âm thanh Polly.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-implementation-steps/3.4-creat-a-new-post-lambda-function/" title="Tạo hàm Lambda cho bài đăng mới"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/3-implementation-steps/3.6-test-the-functions/" title="Kiểm tra các chức năng" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1726994306"></script>
    <script src="/js/perfect-scrollbar.min.js?1726994306"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1726994306"></script>
    <script src="/js/jquery.sticky.js?1726994306"></script>
    <script src="/js/featherlight.min.js?1726994306"></script>
    <script src="/js/highlight.pack.js?1726994306"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1726994306"></script>
    <script src="/js/learn.js?1726994306"></script>
    <script src="/js/hugo-learn.js?1726994306"></script>

    <link href="/mermaid/mermaid.css?1726994306" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1726994306"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
